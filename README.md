Devbox
======

The Devbox is a Vagrant Ubuntu development machine provisioned and preconfigured for working with a git project including a development stack of Nginx, PHP5.5, php-fpm, xdebug, composer, MySQL 5.5, Redis, Beanstalkd, supervisord, Sphinx, ngrok, Node.js, MongoDB, Imagemagick


## Features / Stack
Ubuntu 14.04 64bit, Nginx, PHP5.5, php-fpm, xdebug, composer, MySQL 5.5, Redis, Beanstalkd, supervisord, Sphinx, ngrok, Node.js, MongoDB, Imagemagick


## Requirements

* [VirtualBox](https://www.virtualbox.org/wiki/Downloads) - Free virtualization software 
* [Vagrant](https://www.vagrantup.com) - Tool for working with VirtualBox images
* [Git](http://git-scm.com/downloads) - Required for getting code from our repository


## Initial Setup

* Install VirtualBox and Vagrant ( >= 1.5.0)
* Install Git
* Add the vagrant puppet plugin
    $ vagrant plugin install vagrant-puppet-install
* Clone this repository 
	$ git clone your.git $DIR
where $DIR is the directory where you want your Development machine to be installed 
* From inside the directory $DIR run  
	$ vagrant up
(the first time you run Vagrant it will fetch the virtual box image which is ~350MB. So this could take some time. It will also ask for your host account password shortly after downloading)
* Vagrant will now use Puppet to provision the devbox (this could take a few minutes). Following that npm installs a load of packages globally, such as grunt and bower (this could also take a few minutes)
* Point "devbox" and any other vhosts to `192.168.3.3` in your hosts file of your host OS.
	192.168.3.3 devbox 

For instructions on how to edit your hosts file on any given OS, see [here](http://www.rackspace.com/knowledge_center/article/how-do-i-modify-my-hosts-file).

* Now just clone/copy the git project into `www/devbox` and open http://devbox in your browser. 

## Shared Folders
The www folder is automatically synced to the VM (/var/www). This is why we clone our project into this folder. The sync works in both directions. So any files generated by the application (/storage folder for example) will be accessible from your host machine. 

## Port Forwards
From your host you can access the web server at port 8080
and MySQL Server at port 8889
Note that if these ports were already in use, vagrant with automatically assign other ports. You will see this in the log when vagrant up runs.

## Credentials 
* SSH User: none, just type vagrant ssh and you're in. You can also sudo su without a password
* MySQL User: `root` PW: `root`

## Vagrant Commands

* `vagrant up` starts the virtual machine and provisions it
* `vagrant ssh` gives you shell access on the virtual machine
* `vagrant suspend` will essentially put the machine to 'sleep' with `vagrant resume` waking it back up
* `vagrant reload` will reload the VM. Do this when the VM config changed. For exmpale when you changed one of the configs (e.g. php.ini, sphinx.conf, etc. or after a git pull of this repo)
* `vagrant reload` will reload the VM and force it to re-provision. Do this when a new puppet package must be installed
* `vagrant halt` attempts a graceful shutdown of the machine and will need to be brought back with `vagrant up`
* `vagrant halt --force` force shutdown if normal halt doesn't work
* `vagrant destroy` you broke something? this will destroy the VM and reprovisions it again completely. Takes some time.


## Ngrok 

Ngrok creates a tunnel from the public internet (http://subdomain.ngrok.com) to a website on your local machine. You can give this URL to anyone to allow them to try out a website you're developing without doing any deployment.
For all the features and documentation, check their site: `http://ngrok.com` and usage guide: `http://ngrok.com/usage`.

### Setup:
* In `/etc/nginx/sites-available/ngrok.dev` change `root` path (ie. replace `yoursite.dev` with your site directory)
* Make ngrok configuration active by symlinking it: `sudo ln -s /etc/nginx/sites-available/ngrok.dev /etc/nginx/sites-enabled/ngrok.dev`
* Restart nginx by doing `sudo /etc/init.d/nginx restart`
* Start ngrok service with: `ngrok :80`

## Troubleshoot

* NFS folders do not work on Windows hosts. Vagrant will ignore your request for NFS synced folders on Windows.